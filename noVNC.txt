Baik, kasus yang kamu alami **sangat umum** di Raspberry Pi + VNC/noVNC, dan **bukan karena password kamu tiba-tiba salah**, melainkan karena **perbedaan konteks user dan service saat boot**.

Saya jelaskan **akar masalahnya dulu**, lalu **langkah perbaikan yang tepat dan stabil**.

---

## Ringkasannya dulu (biar jelas)

**Masalah utama:**

> Setelah reboot, noVNC/websockify jalan **sebelum** VNC server siap **atau** VNC server berjalan **di user/session yang berbeda**, sehingga **VNC menolak autentikasi**.

Makanya muncul error:

> `New connection has been rejected: username not recognised or password incorrect`

Padahal:

* Sebelum reboot → bisa
* Setelah reboot → gagal

---

## Penyebab paling sering (90% kasus)

### 1. **VNC Server tidak aktif saat boot (atau aktif tapi beda user)**

* VNC **manual jalan** saat kamu login
* Tapi **systemd noVNC jalan lebih dulu**
* Akhirnya noVNC connect ke VNC yang **belum siap / tidak ada**

### 2. **VNC password tersimpan per-user**

Raspberry Pi VNC (RealVNC / tightvnc) **password itu user-specific**, misalnya:

* `pi`
* `root`
* user lain

Jika:

* VNC server jalan sebagai `pi`
* websockify/noVNC jalan sebagai `root`
  → authentication **PASTI DITOLAK**

---

## Cara cek cepat (WAJIB)

Di Raspberry Pi, jalankan:

```bash
ps aux | grep vnc
ps aux | grep websockify
```

Perhatikan:

* VNC jalan sebagai user siapa?
* websockify/noVNC jalan sebagai user siapa?

Kalau **beda user**, itu sumber masalahnya.

---

## Solusi PALING STABIL (direkomendasikan)

### ✅ Gunakan **VNC server system-wide + noVNC systemd**

Bukan VNC manual per-session.

---

## LANGKAH 1 — Pastikan VNC aktif secara resmi

```bash
sudo raspi-config
```

Masuk ke:

```
Interface Options
→ VNC
→ Enable
```

Lalu reboot:

```bash
sudo reboot
```

---

## LANGKAH 2 — Set password VNC untuk user `pi`

Login via SSH, lalu:

```bash
vncpasswd
```

⚠️ **Jalankan sebagai user `pi`, BUKAN sudo**

Kalau pakai RealVNC:

```bash
realvnc-vnc-server
```

---

## LANGKAH 3 — Pastikan VNC benar-benar jalan setelah boot

Setelah reboot:

```bash
systemctl status vncserver-x11-serviced
```

Harus **active (running)**.

Jika belum:

```bash
sudo systemctl enable vncserver-x11-serviced
sudo systemctl start vncserver-x11-serviced
```

---

## LANGKAH 4 — Perbaiki service noVNC (INI BAGIAN KRITIS)

Edit service noVNC:

```bash
sudo nano /etc/systemd/system/novnc.service
```

Gunakan **format yang BENAR** ini:

```ini
[Unit]
Description=noVNC
After=network.target graphical.target vncserver-x11-serviced.service
Requires=vncserver-x11-serviced.service

[Service]
Type=simple
User=pi
WorkingDirectory=/home/pi/noVNC
ExecStart=/usr/bin/websockify \
  --web=/home/pi/noVNC \
  6080 localhost:5900
Restart=always

[Install]
WantedBy=graphical.target
```

⚠️ **PENTING:**

* `User=pi` → HARUS sama dengan user VNC
* `After=vncserver-x11-serviced.service` → tunggu VNC siap
* `graphical.target` → pastikan desktop aktif

---

## LANGKAH 5 — Reload & enable ulang

```bash
sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl enable novnc
sudo systemctl restart novnc
```

Cek:

```bash
systemctl status novnc
```

---

## LANGKAH 6 — TEST FINAL

1. Reboot:

```bash
sudo reboot
```

2. Tunggu ±1 menit
3. Buka browser:

```
http://IP_RASPBERRY:6080
```

4. Login pakai:

* **Username:** kosong / abaikan
* **Password:** hasil `vncpasswd`

---

## Kalau MASIH gagal (plan B)

Cek log real-time:

```bash
journalctl -u novnc -f
```

Atau:

```bash
journalctl -u vncserver-x11-serviced -f
```

Biasanya akan kelihatan:

* VNC belum ready
* Salah port
* Salah user

---

## Kesimpulan Teknis (buat laporan / logbook juga bisa)

> Masalah autentikasi noVNC setelah reboot disebabkan oleh perbedaan konteks eksekusi antara VNC server dan service websockify, di mana noVNC dijalankan sebelum VNC server siap atau menggunakan user yang berbeda. Solusi dilakukan dengan menyelaraskan user eksekusi, dependency service, dan target boot grafis menggunakan systemd.

Kalau kamu mau, aku bisa:

* Validasi **service file kamu satu per satu**
* Buatkan **versi paling minimal & clean**
* Atau sesuaikan dengan **Raspberry Pi 3 headless / tanpa monitor**

Tinggal bilang.
